## Overview

자바스크립트는 기본적으로 동기식으로 작동합니다. 그러나 비동기 코드를 처리하기 위해서는 '이벤트 루프'라는 개념을 이해해야 합니다. 여기서는 자바스크립트 런타임 중 가장 유명한 V8 엔진을 기준으로 설명합니다. 다른 자바스크립트 런타임에서도 약간의 차이가 있을 수 있습니다.

## 호출 스택과 이벤트 루프

호출 스택은 자바스크립트에서 수행해야 할 코드나 함수를 순차적으로 담아두는 스택입니다. 아래 예제를 통해 호출 스택의 작동 방식을 설명합니다:

```jsx
function bar() {
  console.log("bar");
}

function baz() {
  console.log("baz");
}

function foo() {
  console.log("foo");
  bar();
  baz();
}

foo();
```

이 코드는 foo를 호출하고, 내부에서 bar, baz를 순차적으로 호출합니다. 호출 스택은 다음과 같은 순서로 작동합니다:

foo()가 호출 스택에 들어갑니다.

foo() 내부의 console.log가 호출 스택에 들어갑니다.

console.log('foo')가 실행되고 호출 스택에서 제거됩니다.

bar()가 호출 스택에 들어갑니다.

bar() 내부의 console.log가 호출 스택에 들어갑니다.

console.log('bar')가 실행되고 호출 스택에서 제거됩니다.

bar()가 호출 스택에서 제거됩니다.

baz()가 호출 스택에 들어갑니다.

baz() 내부의 console.log가 호출 스택에 들어갑니다.

console.log('baz')가 실행되고 호출 스택에서 제거됩니다.

baz()가 호출 스택에서 제거됩니다.

foo()가 호출 스택에서 제거됩니다.

이벤트 루프의 역할
이벤트 루프는 호출 스택이 비어 있는지 확인하고, 비어 있다면 태스크 큐에서 작업을 가져와 실행합니다. 이벤트 루프와 호출 스택 모두 단일 스레드에서 작동하며, 순차적으로 실행됩니다.

비동기 작업의 처리
비동기 작업은 어떻게 실행될까요? 아래 코드를 예로 들어보겠습니다:

```jsx
코드 복사
function bar() {
console.log('bar');
}

function baz() {
console.log('baz');
}

function foo() {
console.log('foo');
setTimeout(bar, 0);
baz();
}

foo();
```

이 코드는 foo, baz, bar 순으로 출력됩니다. 호출 스택에서는 다음과 같은 일이 발생합니다:

foo()가 호출 스택에 들어갑니다.

foo() 내부의 console.log가 호출 스택에 들어갑니다.

console.log('foo')가 실행되고 호출 스택에서 제거됩니다.

setTimeout(bar, 0)가 호출 스택에 들어갑니다.

타이머 이벤트가 실행되며 bar가 태스크 큐로 들어가고, setTimeout은 호출 스택에서 제거됩니다.

baz()가 호출 스택에 들어갑니다.

baz() 내부의 console.log가 호출 스택에 들어갑니다.

console.log('baz')가 실행되고 호출 스택에서 제거됩니다.

baz()가 호출 스택에서 제거됩니다.

foo()가 호출 스택에서 제거됩니다.

이제 호출 스택이 비워졌으므로, 이벤트 루프가 태스크 큐에서 bar를 호출 스택으로 가져와 실행합니다.

태스크 큐
태스크 큐는 비동기 함수의 콜백 함수나 이벤트 핸들러 등을 담고 있습니다. 이벤트 루프는 호출 스택이 비어 있을 때 태스크 큐의 대기 중인 작업을 순차적으로 꺼내와 실행합니다.

비동기 작업의 실행
비동기 작업은 자바스크립트 코드 외부에서 별도의 스레드에서 실행됩니다. 예를 들어, setTimeout이나 네트워크 요청은 브라우저나 Node.js에서 관리하고, 완료된 작업의 콜백은 태스크 큐로 들어갑니다.

이벤트 루프는 호출 스택이 비고, 실행 가능한 콜백이 태스크 큐에 있을 때 이를 호출 스택에 올려 실행합니다. 이를 통해 자바스크립트는 비동기 작업을 처리할 수 있습니다.

이러한 구조 덕분에 자바스크립트는 싱글 스레드로 작동하면서도 비동기 작업을 효율적으로 처리할 수 있습니다.

출처: React Deep Dive
